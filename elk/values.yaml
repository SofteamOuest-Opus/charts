# Default values for ELK.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  tag: stable
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 80

ingress:
  enabled: true
  annotations:
    certmanager.k8s.io/cluster-issuer: letsencrypt-issuer
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/auth-type: basic
    # message to display with an appropriate context why the authentication is required
    nginx.ingress.kubernetes.io/auth-realm: 'Authentication Required'
  path: /
  hosts:
  - kibana.k8.wildwidewest.xyz
  secretName: kibana-secret
  tls:
  - hosts:
    - kibana.k8.wildwidewest.xyz
    secretName: kibana-secret

resources: {}

nodeSelector: {}

tolerations: []

affinity: {}

data:
  hooks:
    drain:
      enabled: False

filebeat:
  config:
    output:
      file:
        enabled: false
      elasticsearch:
        hosts: [ 'elk-elasticsearch-client:9200' ]
        pipeline: opus_log
    setup:
      kibana:
        host: elk-kibana:80

metricbeat:
  deployment:
    modules:
      kubernetes:
        enabled: true
        config:
        - module: kubernetes
          hosts: ["elk-kube-state-metrics:8080"]
  daemonset:
    config:
      output.file:
        enabled: false
      output:
        elasticsearch:
          hosts: [ 'elk-elasticsearch-client:9200' ]
      setup:
        kibana:
          host: elk-kibana:80
    modules:
      system:
        enabled: true
        config:
        - module: system
          period: 10s
          metricsets:
          - cpu
          - load
          - memory
          - network
          - process
          - process_summary
          # - core
          # - diskio
          # - socket
          processes: ['.*']
          process.include_top_n:
            by_cpu: 5      # include top 5 processes by CPU
            by_memory: 5   # include top 5 processes by memory
        - module: system
          period: 1m
          metricsets:
          - filesystem
          - fsstat
          processors:
          - drop_event.when.regexp:
              system.filesystem.mount_point: '^/(sys|cgroup|proc|dev|etc|host|lib)($|/)'
      kubernetes:
        enabled: true
        config:
        - module: kubernetes
          metricsets:
          - node
          - system
          - pod
          - container
          - volume
          host: ${NODE_NAME}
          hosts: ["https://${HOSTNAME}:10250"]
          bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
          ssl.certificate_authorities:
            - /var/run/secrets/kubernetes.io/serviceaccount/service-ca.crt
elastalert:
  elasticsearch:
    host: elk-elasticsearch-client
    port: 9200

kibana:
  service:
    externalPort: 80
  ingress:
    enabled: False
    hosts:
      - kibana.k8.wildwidewest.xyz
    annotations:
      certmanager.k8s.io/cluster-issuer: letsencrypt-issuer
      kubernetes.io/ingress.class: nginx
    tls:
      - hosts:
          - kibana.k8.wildwidewest.xyz
        secretName: kibana-secret
    secretName: kibana
  env:
    ELASTICSEARCH_URL: http://elk-elasticsearch-client:9200


